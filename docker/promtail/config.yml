server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions/positions.yaml

clients:
  - url: http://loki:3100/loki/api/v1/push

scrape_configs:
  # Systemd journal - scrapes all host logs directly from journal
  # Replaces rsyslog-dependent file jobs (syslog, auth, kernel, cron)
  - job_name: journal
    journal:
      json: false
      max_age: 48h
      labels:
        job: systemd-journal
        host: router
      # path auto-detected: checks /var/log/journal then /run/log/journal
    relabel_configs:
      - source_labels: ['__journal__systemd_unit']
        target_label: 'unit'
      - source_labels: ['__journal_syslog_identifier']
        target_label: 'syslog_identifier'
      - source_labels: ['__journal_priority_keyword']
        target_label: 'level'

  # Credential scrubber audit log
  - job_name: scrub-transcripts
    static_configs:
      - targets: [localhost]
        labels:
          job: scrub-transcripts
          host: router
          __path__: /var/log/scrub-transcripts/*.log

  # Vault audit logs (JSON format)
  - job_name: vault-audit
    static_configs:
      - targets: [localhost]
        labels:
          job: vault-audit
          host: router
          __path__: /vault/logs/audit.log
    pipeline_stages:
      - json:
          expressions:
            type: type
            auth_accessor: auth.accessor
            operation: request.operation
            path: request.path
      - labels:
          type:
          operation:
