- name: ensure required pip-packages are installed
  pip:
    name:
      - docker
      - PyYAML
      - docker-compose

- name: Template out compose file to docker directory on host
  ansible.builtin.template:
    src: "{{ lookup('env', 'CI_PROJECT_DIR') + '/docker/docker-compose.yml' }}"
    dest: "{{ docker_persistent_data_path + '/docker-compose.yml' }}"
    owner: root
    group: root
    mode: '0755'

- name: Create and start Docker services
  community.docker.docker_compose:
    project_name: docker
    project_src: "{{ docker_persistent_data_path }}"
    state: present

- name: Template out compose file to docker directory on host
  ansible.builtin.template:
    src: "{{ lookup('env', 'CI_PROJECT_DIR') + '/docker/nextcloud/config.php' }}"
    dest: "{{ docker_persistent_data_path + '/nextcloud/config/config.php' }}"
    owner: www-data
    group: www-data
    mode: '0644'
