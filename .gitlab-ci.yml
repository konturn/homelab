.ansible:
  stage: ansible
  image: python:3.8
  before_script:
    - apt update && apt install -y rsync
    - pip install ansible
    - ansible-galaxy install -r ansible/requirements.yml
    - echo ${ROUTER_PRIVATE_KEY_BASE64}|base64 -d > tmp
    - chmod 600 tmp
    - mkdir ~/.ssh
    - cp ansible/known_hosts ~/.ssh/known_hosts

stages:
  - ansible

bootstrap-config:
  extends: .ansible
  script:
    - ansible-playbook -i ansible/inventory.yml -u root --private-key=tmp ansible/main.yml
