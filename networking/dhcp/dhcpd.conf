# dhcpd.conf
#
# Sample configuration file for ISC dhcpd
#
# Attention: If /etc/ltsp/dhcpd.conf exists, that will be used as
# configuration file instead of this file.
#

# option definitions common to all supported networks...
option domain-name "lab.nkontur.com";
option domain-name-servers 1.1.1.1, 8.8.8.8;

default-lease-time 600;
max-lease-time 7200;

# The ddns-updates-style parameter controls whether or not the server will
# attempt to do a DNS update when a lease is confirmed. We default to the
# behavior of the version 2 packages ('none', since DHCP v2 didn't
# have support for DDNS.)
ddns-update-style none;

# If this DHCP server is the official DHCP server for the local
# network, the authoritative directive should be uncommented.
authoritative;

omapi-port 7911;
omapi-key omapi_key;

key omapi_key {
     algorithm hmac-md5;
     secret {{ omapi_secret }};
}

failover peer "failover-partner" {
     address {{ dhcp_address }};
     port 519;
     peer address {{ dhcp_peer_address }};
     peer port 519;
     max-response-delay 60;
     max-unacked-updates 10;
     {% if is_primary_router %}
     primary;
     mclt 60;
     split 128;
     load balance max seconds 3;
     {% else %}
     secondary;
     {% endif %}
}

subnet 10.4.0.0 netmask 255.255.0.0 {
   pool {
     range 10.4.64.0 10.4.127.255;
     failover peer "failover-partner";
     option routers 10.4.0.1;
     option domain-name-servers {{ pihole_ip }}, 1.1.1.1;
   }
}

{% if is_primary_router %}

host movie-switch {
   hardware ethernet {{ movie_switch_mac }};
   fixed-address {{ movie_switch_address }};
}

host office-switch {
   hardware ethernet {{ office_switch_mac }};
   fixed-address {{ office_switch_address }};
}

host ipmi {
   hardware ethernet {{ ipmi_mac }};
   fixed-address {{ ipmi_address }};
}

host ups {
   hardware ethernet {{ ups_mac }};
   fixed-address {{ ups_address }};
}

host shield {
   hardware ethernet {{ shield_mac }};
   fixed-address {{ shield_address }};
}

host denon {
   hardware ethernet {{ denon_mac }};
   fixed-address {{ denon_address }};
}

host projector {
   hardware ethernet {{ projector_mac }};
   fixed-address {{ projector_address }};
}

host zwave {
   hardware ethernet {{ zwave_mac }};
   fixed-address {{ zwave_address }};
}

host snapclient {
   hardware ethernet {{ snapclient_mac }};
   fixed-address {{ snapclient_address }};
   option domain-name-servers {{ pihole_ip }}, 1.1.1.1;
}

host amp {
   hardware ethernet {{ amp_mac }};
   fixed-address {{ amp_address }};
}

host doorbell {
   hardware ethernet {{ doorbell_mac }};
   fixed-address {{ doorbell_address }};
}

subnet 10.5.0.0 netmask 255.255.0.0 {
   range 10.5.64.0 10.5.127.255;
   option routers 10.5.0.1;
   option domain-name-servers 1.1.1.1;
}

subnet 10.6.0.0 netmask 255.255.0.0 {
   option routers 10.6.0.1;
   range 10.6.64.0 10.6.127.255;
   option domain-name-servers 1.1.1.1;
}
{% endif %}

