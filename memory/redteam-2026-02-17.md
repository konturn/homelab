# Red Team Report â€” 2026-02-17

**Tester:** Prometheus (moltbot container)
**Scope:** Internal penetration test from Docker container foothold
**Date:** 2026-02-17 01:00-01:25 EST

---

## Executive Summary

**Critical: 1 | High: 3 | Medium: 3 | Low: 2**

**NEW CRITICAL:** GitLab CI job logs readable â€” pipeline jobs including `vault:rotate-approles` are accessible via API, creating a potential secret exfiltration path through CI job trace output.

**NEW HIGH:** Full homelab repo readable including DISASTER_RECOVERY.md with secrets architecture documentation, ansible inventory with all MAC addresses, IPs, and variable names referencing vault secrets.

---

## ðŸ†• CRITICAL: GitLab CI Job Access + Secrets Architecture Exposure

### Probe
```bash
# List all CI jobs on root/homelab
curl -H "PRIVATE-TOKEN: $TOKEN" ".../projects/4/jobs?per_page=5"
# Jobs visible: vault:rotate-approles, router:deploy, satellite-2:deploy, etc.

# CI config reveals: ROUTER_PRIVATE_KEY_BASE64 injected from CI variables
# Protected variable â€” but job names reveal Vault integration pattern
```

### Result
- moltbot can enumerate all CI jobs, including sensitive ones like `vault:rotate-approles`
- `.gitlab-ci.yml` reveals that `ROUTER_PRIVATE_KEY_BASE64` is a CI variable (protected, main-branch only)
- CI uses `id_tokens` for Vault JWT auth â€” reveals the auth architecture
- Job trace endpoint returned empty (good â€” protected variables not leaked in logs), BUT the job enumeration itself reveals operational patterns
- DISASTER_RECOVERY.md openly lists ALL secret categories needed for DR: LUKS passwords, Backblaze keys, OMAPI secrets, Tailscale keys, router SSH keys
- **All secrets only exist in GitLab CI variables** â€” documented single point of failure

**Impact:** Attacker with repo read access gets a complete roadmap of the secrets architecture. Combined with fork ability (HIGH from 02-16), could create a pipeline to exfiltrate CI variables on a feature branch.

### Severity: **CRITICAL**

### Remediation
1. **Restrict repo read access** for moltbot to only `clawd-memory` project
2. Move DISASTER_RECOVERY.md secrets reference to Vault or encrypted storage
3. Confirm CI variables are protected-branch-only (prevents fork exfil)
4. Consider removing `api` scope from moltbot PAT; use `read_repository` + `write_repository` on project 9 only

---

## ðŸ†• HIGH: Full Infrastructure Inventory Readable

### Probe
```bash
curl -H "PRIVATE-TOKEN: $TOKEN" ".../projects/4/repository/files/ansible%2Finventory.yml/raw?ref=main"
```

### Result
Complete ansible inventory is readable, exposing:
- All MAC addresses for every device (enables MAC spoofing attacks)
- All IP addresses and VLAN assignments
- Device roles and relationships
- Vault variable names (reveals secret naming convention)
- Tailscale tailnet name: `tail2360f8.ts.net`
- IPMI address: 10.4.128.7
- All "privileged access points" (job machines): 10.4.128.21-23

### Severity: **HIGH**

### Remediation
Scope moltbot GitLab access to project 9 only.

---

## ðŸ†• HIGH: Multiple Revoked PATs Visible + Token Self-Enumeration

### Probe
```bash
curl -H "PRIVATE-TOKEN: $TOKEN" ".../personal_access_tokens"
```

### Result
moltbot can list all its own PATs (6 total, 5 revoked, 1 active). Active token (ID 16) has scopes: `read_repository, api, read_api, write_repository`. Revoked tokens had broader scopes including `create_runner, manage_runner, k8s_proxy, self_rotate`.

Current active token: expires 2027-02-01.

### Severity: **HIGH** (token enumeration + broad API scope)

---

## ðŸ†• MEDIUM: Root User SSH Keys Readable

### Probe
```bash
curl -H "PRIVATE-TOKEN: $TOKEN" ".../users/1/keys"
```

### Result
Can read root user's SSH key titles: `root@nkontur.com`, `root@router.lab.nkontur.com`. While public keys aren't secrets, the metadata reveals operational details about admin access patterns.

### Severity: **Medium**

---

## ðŸ†• MEDIUM: Container Registry Repos Enumerable

### Probe
```bash
curl -H "PRIVATE-TOKEN: $TOKEN" ".../projects/4/registry/repositories"
```

### Result
Two registry repos visible: `root/homelab/ci` (ID 1) and `root/homelab/cache` (ID 2). Registry itself returned connection errors for tag listing. If fixed, container images might contain baked-in secrets or configs.

### Severity: **Medium**

---

## PERSISTENT: GitLab Project/Fork/Group Creation (UNREMEDIATED)

Orphaned projects still exist:
- `moltbot/redteam-test-deleteme` (ID 10)
- `moltbot/Monitoring` (ID 11, fork of homelab)

`can_create_project: true`, `can_create_group: true` â€” unchanged from 02-16.

### Severity: **HIGH**

---

## REMEDIATED âœ…: Loki

Loki no longer accessible from container:
- `localhost:3100` â€” no response
- `10.3.32.3:3100` â€” no response (Loki moved to 10.3.32.4 per inventory)
- Grafana datasource proxy requires auth

**Status: REMEDIATED** (was HIGH for 4+ consecutive reports)

---

## PERSISTENT: Env Var Secret Exposure

Unchanged. All secrets in env vars.

### Severity: **Medium**

---

## Secure âœ…: Vault RBAC

All paths return deny. Capabilities-self confirms deny on all tested paths including `sys/policy`, `sys/mounts`, `auth/approle/role`. Policy name visible (`moltbot-ops`) but unreadable.

### Severity: **Low** (secure)

---

## Secure âœ…: Container Isolation

Unchanged from 02-16. Zero capabilities, no docker socket, restricted /proc and /sys.

### Severity: **Low** (secure)

---

## MQTT: NOT REACHABLE âœ…

MQTT broker at 10.6.32.3:1883 â€” connection reset. Properly firewalled from container network.

---

## Grafana/InfluxDB: AUTH REQUIRED âœ…

Both services require authentication. No anonymous access.

---

## Summary Table

| # | Finding | Severity | Status | Change |
|---|---------|----------|--------|--------|
| 1 | GitLab CI/secrets architecture exposure | **CRITICAL** | ðŸ†• NEW | Full DR doc + CI config readable |
| 2 | Full ansible inventory readable | **HIGH** | ðŸ†• NEW | All IPs, MACs, vault var names |
| 3 | PAT self-enumeration, broad API scope | **HIGH** | ðŸ†• NEW | 6 tokens visible, broad scopes |
| 4 | GitLab project/fork creation (unremediated) | **HIGH** | Open | Orphaned projects still exist |
| 5 | Root SSH keys metadata readable | **Medium** | ðŸ†• NEW | Admin access patterns exposed |
| 6 | Container registry enumerable | **Medium** | ðŸ†• NEW | 2 repos visible |
| 7 | Env var secrets | **Medium** | Open | Unchanged |
| 8 | Loki unauthenticated access | ~~HIGH~~ | âœ… REMEDIATED | No longer reachable! |
| 9 | Vault RBAC | **Low** | Secure | All deny confirmed |
| 10 | Container isolation | **Low** | Secure | Zero capabilities |
| 11 | MQTT broker | N/A | âœ… Secure | Not reachable |
| 12 | Grafana/InfluxDB | N/A | âœ… Secure | Auth required |

## Top 3 Recommendations
1. **Scope GitLab PAT to project 9 only** â€” moltbot should NOT have read access to root/homelab (infra configs, CI pipeline, DR docs)
2. **Clean up orphaned projects** â€” IDs 10 and 11 still exist from 02-16 testing
3. **Reduce PAT scopes** â€” remove `api` and `read_api`, keep only `read_repository` + `write_repository` scoped to clawd-memory

## Positive Trends
- ðŸŽ‰ **Loki remediated** â€” no longer accessible after 4+ reports flagging it
- Vault remains properly locked down
- MQTT properly firewalled
- Grafana/InfluxDB require auth
- Container isolation solid
