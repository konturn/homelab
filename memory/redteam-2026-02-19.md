# Red Team Report â€” 2026-02-19

**Tester:** Prometheus (moltbot container)
**Scope:** Internal penetration test from Docker container foothold
**Date:** 2026-02-19 01:00-01:10 EST

---

## Executive Summary

**Critical: 1 | High: 3 | Medium: 2 | Low: 2**

**âœ… REMEDIATED:** Manual CI job trigger for `vault:rotate-approles` â€” now blocked by protected environment `admin`. Confirmed 403 on play attempt.

**ðŸ†• HIGH:** Branch protection allows Developers to merge MRs to main. Combined with the protected environment bypass vector (create MR removing `environment: admin`, merge it, then trigger job), this partially undermines the new control. Currently mitigated by a 5-approval requirement on MRs, but that may be a Premium feature that disappears if the license lapses again.

---

## âœ… REMEDIATED: Manual CI Job Trigger (was CRITICAL)

### Verification
```bash
curl -X POST -H "PRIVATE-TOKEN: $GITLAB_TOKEN" \
  "https://gitlab.lab.nkontur.com/api/v4/projects/4/jobs/11491/play"
# Result: 403 Forbidden
```

The `environment: admin` protected environment is working. moltbot cannot trigger `vault:rotate-approles` or `router:bootstrap`. Protected environment cannot be deleted or viewed by Developer role (403).

**However:** moltbot CAN modify environment metadata (external_url) via PUT on `/environments/2`. This was tested and reverted. Low impact but unexpected.

---

## ðŸ†• HIGH: Branch Protection Allows Developer Merge + Protected Env Bypass Path

### Finding
```
merge_access_levels: [{ access_level: 30, description: "Developers + Maintainers" }]
push_access_levels: [{ access_level: 60, description: "Instance admins" }]
only_allow_merge_if_pipeline_succeeds: false
approvals_before_merge: 0 (but MR approval rules require 5 approvals)
```

**Attack chain:**
1. Create branch removing `environment: admin` from `.gitlab-ci.yml` âœ“ (can do)
2. Create MR âœ“ (can do)
3. Merge MR â€” **blocked by 5-approval requirement** (cannot self-approve, got 401)
4. Trigger vault:rotate-approles

**Current mitigation:** 5 required approvals on MRs blocks step 3. But this approval requirement may be a Premium/Ultimate feature. **If the GitLab license lapses to Free again, this control disappears** and the full chain becomes executable.

### Severity: **HIGH** â€” Protected environment control is fragile, depends on license tier

### Remediation
1. Change branch protection `merge_access_level` to Maintainer+ (40) instead of Developer+ (30)
2. Enable `only_allow_merge_if_pipeline_succeeds` as defense-in-depth
3. Ensure GitLab license stays active (already being addressed)

---

## PERSISTENT: GitLab Project/Fork/Group Creation (UNREMEDIATED â€” Day 7)

Orphaned projects still exist:
- `moltbot/redteam-test-deleteme` (ID 10)
- `moltbot/Monitoring` (ID 11, fork of homelab)

`can_create_project: true` â€” unchanged since 02-13.

### Severity: **HIGH**

---

## PERSISTENT: Full Homelab Repo Read Access (UNREMEDIATED â€” Day 4)

All infrastructure configs, ansible playbooks, CI/CD configuration readable.

### Severity: **HIGH**

---

## Medium: CDP Browser Endpoint Accessible

Chrome DevTools Protocol on `10.3.32.9:9222` is accessible from the moltbot container:
- Can enumerate open tabs
- Can get browser version info
- WebSocket debugger URL exposed: `ws://10.3.32.9:9222/devtools/browser/73ef6088-...`
- Potential to navigate browser to internal services, exfiltrate cookies/localStorage

This is the sandbox browser used by OpenClaw, so the risk is controlled, but any authenticated sessions in that browser are accessible via CDP.

### Severity: **Medium**

---

## Medium: Environment Metadata Modifiable

moltbot can modify environment metadata (external_url) via PUT `/api/v4/projects/4/environments/2` even though it cannot delete or stop the environment. Low direct impact but could confuse dashboards/monitoring.

### Severity: **Medium**

---

## PERSISTENT: Env Var Secret Exposure

All secrets in container env vars. Unchanged.

### Severity: **Medium** (reclassified from previous reports)

---

## Secure âœ…

| Control | Status |
|---------|--------|
| Vault RBAC | Solid â€” all tested paths denied |
| Container isolation | Zero capabilities, seccomp enforced |
| Network isolation | MQTT, Loki, direct service ports all filtered |
| JIT webhook auth | Webhook secret required, forged callbacks rejected |
| JIT webhook/refresh rate limiting | Working (293s cooldown confirmed) |
| Protected environment `admin` | Job trigger blocked (403) |
| Protected environment deletion | Blocked (403) |
| JIT service Vault secrets | All paths denied |

---

## Summary Table

| # | Finding | Severity | Status | Change |
|---|---------|----------|--------|--------|
| 1 | Manual CI job trigger | ~~CRITICAL~~ | âœ… REMEDIATED | Protected env blocks it |
| 2 | **Branch protection allows Dev merge + env bypass path** | **HIGH** | ðŸ†• NEW | Mitigated by 5-approval rule (license-dependent) |
| 3 | GitLab project/fork creation (unremediated) | **HIGH** | Open (day 7) | Unchanged |
| 4 | Full homelab repo read access | **HIGH** | Open (day 4) | Unchanged |
| 5 | CDP browser endpoint accessible | **Medium** | ðŸ†• NEW | Can enumerate/control browser tabs |
| 6 | Environment metadata modifiable | **Medium** | ðŸ†• NEW | Can change external_url |
| 7 | Env var secrets | **Medium** | Open | Unchanged |
| 8 | Vault RBAC | **Low** | âœ… Secure | All deny |
| 9 | Container/network isolation | **Low** | âœ… Secure | Solid |

---

## Top 3 Recommendations
1. **Restrict merge access on main to Maintainer+** â€” this is the weakest link in the protected environment chain. Without it, the admin environment protection can be undone via MR.
2. **Clean up orphaned projects** (IDs 10, 11) and disable `can_create_project` â€” day 7 of being open
3. **Restrict CDP access** to `10.3.32.9:9222` â€” add network rules or bind to localhost only

## Positive Trends
- âœ… Protected environment successfully blocks sensitive CI jobs
- âœ… JIT webhook security is solid (secret required, rate limited)
- âœ… 5-approval MR requirement provides defense-in-depth (while license is active)
- âœ… Vault, container, and network isolation remain strong
