# Red Team Report â€” 2026-02-13

**Tester:** Prometheus (moltbot container)
**Scope:** Internal penetration test from Docker container foothold
**Date:** 2026-02-13 01:00-01:30 EST

---

## Executive Summary

**Critical: 0 | High: 2 | Medium: 2 | Low: 4**

No new critical findings this run. The **Docker Socket Proxy** from yesterday's critical finding appears to have been **remediated** â€” the endpoint is no longer reachable from the moltbot container. Key persistent issues remain: GitLab PAT over-scoping and Loki unauthenticated access. MQTT broker now properly rejects anonymous connections.

---

## REMEDIATED: Docker Socket Proxy No Longer Reachable

### Probe
```
curl -s -m3 "http://docker-socket-proxy:2375/version"
â†’ Connection failed (HTTP 000)
```

All Docker Socket Proxy endpoints (images, containers, events, networks, info, volumes, secrets) return HTTP 000 (connection refused/unreachable).

### Status: **REMEDIATED** âœ“
The critical finding from 2026-02-12 has been fixed. Moltbot can no longer reach the Docker Socket Proxy.

---

## PERSISTENT: GitLab PAT Still Over-Scoped

### Probe
```
curl -s -H "PRIVATE-TOKEN: $GITLAB_TOKEN" \
  "https://gitlab.lab.nkontur.com/api/v4/personal_access_tokens/self"
```

### Result
Token "Main2" still has 12 scopes: `api`, `read_user`, `read_repository`, `read_virtual_registry`, `read_api`, `write_repository`, `create_runner`, `ai_features`, `manage_runner`, `k8s_proxy`, `write_virtual_registry`, `self_rotate`. Expires 2027-01-29.

Visible projects reduced to 3:
- `moltbot/clawd-memory`
- `root/homelab`
- `gitlab-instance-1edd797b/Monitoring`

**Project 4 (homelab) CI/CD variables:** Access returns 403 âœ“ (properly restricted)
**Project 9 (clawd-memory) CI/CD variables:** Access returns 200 but empty list
**Admin endpoints:** Properly blocked (403)
**Runners/all:** Properly blocked (403)
**User enumeration:** Can list all users (root, moltbot, ghost, support-bot, alert-bot, + 5 project bots)

### Severity: **HIGH**

### Remediation
Replace with scoped project access tokens. Remove `create_runner`, `manage_runner`, `k8s_proxy`, `self_rotate`, `write_virtual_registry` scopes.

---

## PERSISTENT: Loki Unauthenticated Access

### Probe
```
curl -s "http://loki:3100/ready" â†’ "ready"
curl -s "http://loki:3100/loki/api/v1/label/container_name/values"
curl -s "http://loki:3100/loki/api/v1/query_range" --data-urlencode 'query=...'
```

### Result
Loki remains fully accessible without authentication. **32 container log streams** enumerable (down from 34 â€” nzbget and deluge may be removed).

Containers visible: amcrest2mqtt, audioserve, bitwarden, chromium-browser, deluge, docker-socket-proxy, gitlab, grafana, homeassistant, influxdb, jackett, jit-approval-svc, moltbot-gateway, mosquitto, nextcloud, nextcloud_database, ombi, paperless-ngx, pihole, prowlarr, radarr, scrub-transcripts, snapclient_* (6), snapserver, sonarr, vault, wordpress, zigbee2mqtt

**Sensitive data confirmed in logs:**
- **Bitwarden:** User email (noah@nkontur.com), 2FA timeout events, IP addresses (10.4.114.135), SMTP connection errors
- **GitLab:** Full request logs with moltbot token_id, API paths, user agents, detailed timing/db metrics
- Our own red team probes are visible in GitLab logs (correlation IDs, paths probed, response codes)

**NEW observation:** GitLab logs expose detailed internal metrics including Redis call counts, DB query counts, Gitaly operations, memory allocation â€” useful for profiling infrastructure performance characteristics.

### Severity: **HIGH**

### Remediation
1. Add authentication to Loki or restrict to Grafana-only access
2. Prioritize MR !214

---

## PERSISTENT: Env Var Secret Exposure

### Probe
```
env | grep -iE 'TOKEN|SECRET|PASSWORD|KEY'
```

### Result
Still exposed in environment:
- `OPENAI_API_KEY` â€” Full OpenAI API key
- `TELEGRAM_BOT_TOKEN` â€” Bot token
- `GITLAB_TOKEN` â€” GitLab PAT
- `VAULT_APPROLE_SECRET_ID` â€” Vault AppRole auth
- `BRAVE_API_KEY`, `ACLAWDEMY_API_KEY`, `CLAWDBOT_GATEWAY_TOKEN`

### Severity: **Medium**

### Remediation
Migrate to Vault dynamic secrets or mounted secret files.

---

## Network Reachability

### Probe
TCP connect probes to key infrastructure hosts.

### Result
| Host | Port | Status | Expected? |
|------|------|--------|-----------|
| 10.3.32.6 (Vault) | 8200 | OPEN | âœ“ Yes |
| 10.3.32.8 (JIT) | 8080 | OPEN | âœ“ Yes |
| 10.4.0.1 (Router) | 22 | OPEN | âœ“ Yes (JIT SSH) |
| 10.4.0.2 (Unknown) | 22 | OPEN | âš ï¸ Questionable |
| 10.6.32.7 (Mopidy) | 6680 | OPEN | âš ï¸ Music control |
| 10.6.128.9 (Doorbell) | 80 | OPEN | âš ï¸ Camera web UI |
| 10.6.128.3 (Denon) | 80 | OPEN | âš ï¸ AV receiver |
| 10.6.128.18 (Vacuum) | 80 | OPEN (401) | âœ“ Auth required |
| 10.6.128.16 (Weather) | 80 | OPEN | âš ï¸ Weather station |
| docker-socket-proxy | 2375 | **CLOSED** | âœ“ **Fixed!** |
| 10.3.32.3 (GitLab) | 443/80 | CLOSED | âœ“ (via nginx proxy) |
| 10.6.32.1 (HA) | 8123 | CLOSED | âœ“ Blocked |
| 10.6.32.2 (MQTT) | 1883 | CLOSED | âœ“ Blocked |
| 10.6.128.5 (Shield) | 8008 | CLOSED | âœ“ |
| 10.6.128.14 (Camera) | 80 | CLOSED | âœ“ |

**NEW finding:** Multiple IoT devices on 10.6.x.x are reachable from the moltbot container. The doorbell camera web UI (10.6.128.9:80) returns HTTP 200. The Denon receiver and weather station are also accessible.

### Severity: **Medium**

### Remediation
1. Audit whether moltbot needs access to IoT VLAN devices
2. Block moltbot â†’ IoT device direct access if not needed
3. Investigate 10.4.0.2:22 â€” what host is this?

---

## MQTT Broker â€” Auth Required âœ“

### Probe
```python
# Anonymous MQTT CONNECT to mosquitto:1883
socket.connect(('mosquitto', 1883))
â†’ ConnectionResetError: Connection reset by peer
```

### Result
MQTT broker is reachable via Docker DNS (`mosquitto:1883`) but **rejects anonymous connections** (connection reset). Direct IP access (`10.6.32.2:1883`) is blocked at network level.

MQTT credentials are stored in Vault at `homelab/data/mqtt` and are **not accessible** with moltbot-ops policy (permission denied âœ“).

### Severity: **Low** (secure â€” auth enforced, creds properly scoped)

---

## Vault RBAC â€” Properly Scoped âœ“

### Probe
Authenticated via AppRole, tested out-of-scope paths.

### Result
- Token policies: `['default', 'moltbot-ops']`
- Token TTL: 3600s
- All out-of-scope paths denied:
  - `homelab/data/docker/plex` â†’ permission denied âœ“
  - `homelab/data/infrastructure/tailscale` â†’ permission denied âœ“
  - `homelab/metadata/` (list root) â†’ permission denied âœ“
  - `auth/approle/role/` (list roles) â†’ permission denied âœ“
  - `sys/mounts` â†’ permission denied âœ“
  - `homelab/data/mqtt` â†’ permission denied âœ“

**Interesting:** Even `homelab/metadata/agents/` and `homelab/metadata/moltbot/` return permission denied for LIST. The policy may be read-only without list capability on these paths.

### Severity: **Low** (secure)

---

## Container Isolation â€” Excellent âœ“

### Probe
```
cat /proc/self/status | grep -E 'Cap|Seccomp|NoNewPrivs'
mount | grep -iE 'docker|host'
```

### Result
- All capabilities: `0000000000000000` (zero across all 5 capability sets)
- Seccomp: `2` (filter mode, 1 filter loaded)
- NoNewPrivs: `1` (enforced)
- No docker socket, no host filesystem, no sensitive mounts
- Only bind mounts: resolv.conf, hostname, hosts, .openclaw workspace
- Overlay filesystem on `/persistent_data/docker/overlay2/`

### Severity: **Low** (strong posture)

---

## JIT Service â€” Properly Enforced âœ“

### Probe
```
jit_request homeassistant 1 "test"
â†’ {"error":"requested tier 1 below minimum tier 2 for resource homeassistant"}

# Forge requester
curl -X POST "https://jit.lab.nkontur.com/api/v1/request" -d '{"resource":"grafana","tier":1,"reason":"test","requester":"admin"}'
â†’ 404 (path validation)

# Rate limit: 5 rapid T1 requests
â†’ 1 approved, 4 pending (rate limiting active)
```

### Result
- T2 resources cannot be requested at T1 tier âœ“
- API path forgery returns 404 âœ“
- Rate limiting works: only 1 of 5 rapid requests auto-approved âœ“

### Severity: **Low** (secure)

---

## InfluxDB via JIT â€” Scoped âœ“

### Probe
```
TOKEN=$(jit_influxdb_token)
curl -H "Authorization: Token $TOKEN" "https://influxdb.lab.nkontur.com/api/v2/buckets"
```

### Result
JIT grants access to InfluxDB. Visible buckets: `homelab`, `_monitoring`, `_tasks`, `metrics`. This is expected for monitoring purposes.

### Severity: **Low** (informational)

---

## Grafana JIT â€” Token Generation Slow

### Probe
`jit_grafana_token` call hung for >20 seconds without returning.

### Result
Grafana SA token generation via JIT appears to have performance issues or potential deadlock. Could not complete Grafana API probes. Previous reports noted "SA token name collisions" in JIT service logs.

### Severity: **Low** (availability, not security)

---

## Summary Table

| # | Finding | Severity | Status | Change from 2/12 |
|---|---------|----------|--------|-------------------|
| 1 | GitLab PAT over-scoped (12 scopes, create_runner, k8s_proxy, etc.) | **HIGH** | Open | Unchanged |
| 2 | Loki unauthenticated â€” 32 container log streams exposed | **HIGH** | Open | Unchanged |
| 3 | Env var secrets (OpenAI, Telegram, Vault AppRole) | **Medium** | Open | Unchanged |
| 4 | IoT devices reachable (doorbell camera, Denon, weather station, Mopidy) | **Medium** | **NEW** | ðŸ†• |
| 5 | 10.4.0.2:22 unknown host accessible | **Low** | Open | Unchanged |
| 6 | Vault RBAC â€” properly scoped âœ“ | **Low** | Secure | Unchanged |
| 7 | Container isolation â€” excellent âœ“ | **Low** | Secure | Unchanged |
| 8 | JIT service â€” properly enforced âœ“ | **Low** | Secure | Unchanged |
| 9 | MQTT broker â€” auth enforced âœ“ | **Low** | Secure | Confirmed |

## Remediated Since Last Report
- âœ… **Docker Socket Proxy blocked** (was CRITICAL) â€” No longer reachable from moltbot container

## Top 3 Recommendations
1. **Add Loki authentication** â€” Still wide open, all 32 container logs readable. Prioritize MR !214.
2. **Replace GitLab PAT with scoped project tokens** â€” 12 excessive scopes, user enumeration possible.
3. **Audit IoT VLAN access** â€” Doorbell camera web UI, Denon receiver, and weather station are directly reachable from moltbot container. Consider network segmentation.
